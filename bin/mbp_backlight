#!/bin/sh

# Anthony Fejes (apfejes@gmail.com)
# Template taken from post by Fran Di√©guez at
# http://www.mabishu.com/blog/2010/06/24/macbook-pro-keyboard-backlight-keys-on-ubuntu-gnulinux/
#
# This program just modifies the value of video brightness for Apple Laptops
# You must run it as root user or via sudo.
# To avoid typing the password (and so be able to use it with a shortcut within
# your Window Manager).
# You need ta create a file in '/etc/sudoers.d/mbp_backlight'
# And put roughly this:
#
# <USERNAME>	ALL=NOPASSWD: /path/to/mbp_backlight
#
# Be warned, if you add this line somewhere in /etc/sudoers, you have to take
# the order in which the rules are proceded into account.
#
# After this you can use this script as follows:
#
#     Increase backlight keyboard:
#           $ sudo mbp_backlight up
#     Decrease backlight keyboard:
#           $ sudo mbp_backlight down
#

BACKLIGHT=$(cat /sys/class/backlight/gmux_backlight/brightness)
MAX=$(cat /sys/class/backlight/gmux_backlight/max_brightness)
MIN=0
INCREMENT=50

if [ "$(id -u)" -ne 0 ]; then
	echo "Please run this program as superuser"
	exit 1
fi

case $1 in

	up)
		TOTAL=$((BACKLIGHT+INCREMENT))
		[ "$BACKLIGHT" -eq "$MAX" ] && exit 1
		[ "$TOTAL" -gt "$MAX" ] && TOTAL=$MAX
		echo $TOTAL > /sys/class/backlight/gmux_backlight/brightness
		;;
	down)
		TOTAL=$((BACKLIGHT-INCREMENT))
		[ "$BACKLIGHT" -eq "$MIN" ] && exit 1
		[ "$TOTAL" -lt "$MIN" ] && TOTAL=$MIN
		echo $TOTAL > /sys/class/backlight/gmux_backlight/brightness
		;;
	*)
		echo "Use: mbp_backlight up|down"
		;;
esac

exit 0
